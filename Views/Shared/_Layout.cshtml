<!-- _Layout.cshtml -->
@using FrontendHelper.Services
@inject AuthService authService

<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - FrontendHelper</title>

    <!-- Google Fonts: Varela Round -->
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet" />
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="~/css/layoutStyle.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body class="d-flex flex-column h-100">
    <header class="top-navbar">
        <div class="container d-flex align-items-center justify-content-between">
            <!-- Logo -->
            <a class="navbar-brand d-flex align-items-center" asp-area="" asp-controller="Home" asp-action="Index">
                <!-- Icon colored as text -->
                <i class="bi bi-app-indicator logo-icon"></i>
                <span class="logo-text">FRONTENDHELPER</span>
            </a>
            <!-- Desktop menu dropdown -->
            <div class="dropdown d-none d-lg-block me-3">
                <button class="btn btn-link dropdown-toggle" type="button" id="desktopMenu" data-bs-toggle="dropdown" aria-expanded="false">
                    Меню
                </button>
                <ul class="dropdown-menu dropdown-glow" aria-labelledby="desktopMenu">
                    <li><a class="dropdown-item nav-link-item" asp-controller="Icon" asp-action="ShowGroupsOfIconsOnTheTopic">Иконки</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Picture" asp-action="ShowPreviewPictureOnTheTopic">Картинки</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="AnimatedElement" asp-action="ShowGroupsOfAnimatedElementsOnTheTopic">Анимированные</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Button" asp-action="ShowAllButtons">Кнопки</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Font" asp-action="ShowFonts">Шрифты</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Form" asp-action="ShowAllForms">Формы</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Palette" asp-action="ShowAllPalettes">Палитры</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="Template" asp-action="ShowAllTemplates">Шаблоны</a></li>
                    <li><a class="dropdown-item nav-link-item" asp-controller="QrCode" asp-action="GenerateQrCode">QR-код</a></li>
                </ul>
            </div>
            <!-- Mobile menu toggle -->
            <button class="btn mobile-menu-btn d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNav" aria-controls="mobileNav" aria-expanded="false" aria-label="Toggle navigation">
                <i class="bi bi-list h3 mb-0 text-dark"></i>
            </button>
            <!-- Right icons -->
            <div class="right-icons d-flex align-items-center">
                <div class="dropdown me-3">
                    <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                        <!-- Contact icon -->
                        <i class="bi bi-telephone-fill header-icon"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-glow" aria-labelledby="">
                        <li><a class="dropdown-item" href="tel:+123456789">+1 234 567 89</a></li>
                        <li><a class="dropdown-item" href="mailto:info@frontendhelper.com">info@frontendhelper.com</a></li>
                    </ul>
                </div>
                <a class="me-3 theme-toggle" id="themeToggle" href="#" title="Toggle theme"><i class="bi bi-brightness-high h4 mb-0"></i></a>
                <!-- Profile icon -->
                <a data-bs-toggle="offcanvas" data-bs-target="#offcanvasProfile" aria-controls="offcanvasProfile">
                    <i class="bi bi-person-circle header-icon"></i>
                </a>
            </div>
        </div>
        <!-- Mobile navigation menu -->
        <div class="collapse" id="mobileNav">
            <nav class="mobile-nav-links d-flex flex-column bg-light p-3">
                <a class="mobile-item py-2 nav-link-item" asp-controller="Icon" asp-action="ShowGroupsOfIconsOnTheTopic">Иконки</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Picture" asp-action="ShowPreviewPictureOnTheTopic">Картинки</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="AnimatedElement" asp-action="ShowGroupsOfAnimatedElementsOnTheTopic">Анимированные</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Button" asp-action="ShowAllButtons">Кнопки</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Font" asp-action="ShowFonts">Шрифты</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Form" asp-action="ShowAllForms">Формы</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Palette" asp-action="ShowAllPalettes">Палитры</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="Template" asp-action="ShowAllTemplates">Шаблоны</a>
                <a class="mobile-item py-2 nav-link-item" asp-controller="QrCode" asp-action="GenerateQrCode">QR-код</a>
            </nav>
        </div>
    </header>

    <!-- Offcanvas Profile -->
    <div class="offcanvas offcanvas-end offcanvas-glow" tabindex="-1" id="offcanvasProfile" aria-labelledby="offcanvasProfileLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasProfileLabel">Профиль</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Закрыть"></button>
        </div>
        <div class="offcanvas-body">
            @if (authService.IsAuthenticated())
            {
                <p>Добро пожаловать, <strong>@authService.GetUserName()</strong></p>
                <ul class="list-unstyled">
                    <li class="mb-2"><a asp-controller="Favorites" asp-action="Index" class="btn btn-glow w-100 text-center">Мои избранные</a></li>
                    @if (authService.IsAdmin())
                    {
                        <li class="mb-2"><a asp-controller="User" asp-action="Index" class="btn btn-glow w-100 text-center">Пользователи</a></li>
                        <li class="mb-2"><a asp-controller="User" asp-action="ShowRoles" class="btn btn-glow w-100 text-center">Роли пользователей</a></li>
                    }
                    <li><a asp-controller="Authentication" asp-action="Logout" class="btn btn-glow w-100 text-center">Выйти</a></li>
                </ul>
            }
            else
            {
                <ul class="list-unstyled">
                    <li class="mb-2"><a asp-controller="Authentication" asp-action="Login" class="btn btn-glow w-100 text-center">Вход</a></li>
                    <li><a asp-controller="Authentication" asp-action="Registration" class="btn btn-glow w-100 text-center">Регистрация</a></li>
                </ul>
            }
        </div>
    </div>

    <!-- Main Content -->
    <main class="content-wrapper flex-fill">
        <div class="container py-4">
            <!-- Search bar -->
            <form class="d-flex mb-5 align-items-center justify-content-center" method="get" asp-controller="Search" asp-action="Index">
                <input type="hidden" name="resourceTypeFilter" value="@(ViewBag.CurrentResourceType ?? "")" />
                <input name="searchQuery" type="text" value="@(ViewBag.CurrentQuery ?? "")" class="form-control search-input me-2" placeholder="Поиск..." />
                <button type="submit" class="btn btn-glow btn-lg text-center">Найти</button>
            </form>
            @RenderBody()
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-bar mt-auto">
        <div class="container text-center py-3">
            <p class="mb-0">&copy; 2025 FrontendHelper | <a href="#" class="footer-link nav-link-item">О нас</a> | <a href="#" class="footer-link nav-link-item">Помощь</a> | <a href="#" class="footer-link nav-link-item">Контакты</a></p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", required: false)
    <script>
        // Theme toggle
        const htmlEl = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', e => {
          e.preventDefault();
          const current = htmlEl.getAttribute('data-theme');
          const next = current === 'light' ? 'dark' : 'light';
          htmlEl.setAttribute('data-theme', next);
          localStorage.setItem('theme', next);
        });
        const saved = localStorage.getItem('theme');
        if (saved === 'dark' || saved === 'light') {
          htmlEl.setAttribute('data-theme', saved);
        }
    </script>
</body>
</html>